<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Thread Safety | LuaJava</title>
    <meta name="description" content="Lua for Java">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.Bxm2A8QI.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.C-OcUPZ8.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.BgJwcenu.js">
    <link rel="modulepreload" href="/assets/chunks/framework.FXXHEqG5.js">
    <link rel="modulepreload" href="/assets/threadsafety.md.-geGDuQm.lean.js">
    <link rel="icon" href="/favicon.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>const load=()=>{import("/pagefind/pagefind.js").then(e=>{window.__pagefind__=e,e.init()}).catch(()=>{})};window.requestIdleCallback?window.requestIdleCallback(load):setTimeout(load,0);</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-bdda0f1c><!--[--><!--]--><!--[--><span tabindex="-1" data-v-ae0349c4></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-ae0349c4>Skip to content</a><!--]--><!----><header class="VPNav" data-v-bdda0f1c data-v-6e3b73c3><div class="VPNavBar" data-v-6e3b73c3 data-v-2357968b><div class="wrapper" data-v-2357968b><div class="container" data-v-2357968b><div class="title" data-v-2357968b><div class="VPNavBarTitle has-sidebar" data-v-2357968b data-v-837251d9><a class="title" href="/" data-v-837251d9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/lua-java.svg" alt data-v-b8e44ffe><!--]--><span data-v-837251d9>LuaJava</span><!--[--><!--]--></a></div></div><div class="content" data-v-2357968b><div class="content-body" data-v-2357968b><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-2357968b data-v-db4f61a0><div class="nav-search-btn-wait" data-v-db4f61a0><span data-v-db4f61a0><svg width="14" height="14" viewBox="0 0 20 20" data-v-db4f61a0><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-db4f61a0></path></svg></span><span class="search-tip" data-v-db4f61a0>Search</span><span class="metaKey" data-v-db4f61a0> K </span></div><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2357968b data-v-076e4a86><span id="main-nav-aria-label" class="visually-hidden" data-v-076e4a86> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-076e4a86 data-v-9b2aaf79><!--[--><span data-v-9b2aaf79>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/javadoc/index.html" target="_self" tabindex="0" data-v-076e4a86 data-v-9b2aaf79><!--[--><span data-v-9b2aaf79>Javadoc</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://www.lua.org" target="_blank" rel="noreferrer" tabindex="0" data-v-076e4a86 data-v-9b2aaf79><!--[--><span data-v-9b2aaf79>Lua</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://luajit.org/luajit.html" target="_blank" rel="noreferrer" tabindex="0" data-v-076e4a86 data-v-9b2aaf79><!--[--><span data-v-9b2aaf79>LuaJIT</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-2357968b data-v-b8b8818d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-b8b8818d data-v-bddde6d6 data-v-7edd5318><span class="check" data-v-7edd5318><span class="icon" data-v-7edd5318><!--[--><span class="vpi-sun sun" data-v-bddde6d6></span><span class="vpi-moon moon" data-v-bddde6d6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2357968b data-v-32c0c33b data-v-2513fa97><!--[--><a class="VPSocialLink no-icon" href="https://github.com/gudzpoz/luajava" aria-label="github" target="_blank" rel="noopener" data-v-2513fa97 data-v-c64b0487><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2357968b data-v-72d47b87 data-v-36a0c1f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-36a0c1f2><span class="vpi-more-horizontal icon" data-v-36a0c1f2></span></button><div class="menu" data-v-36a0c1f2><div class="VPMenu" data-v-36a0c1f2 data-v-ad61f01f><!----><!--[--><!--[--><!----><div class="group" data-v-72d47b87><div class="item appearance" data-v-72d47b87><p class="label" data-v-72d47b87>Appearance</p><div class="appearance-action" data-v-72d47b87><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-72d47b87 data-v-bddde6d6 data-v-7edd5318><span class="check" data-v-7edd5318><span class="icon" data-v-7edd5318><!--[--><span class="vpi-sun sun" data-v-bddde6d6></span><span class="vpi-moon moon" data-v-bddde6d6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-72d47b87><div class="item social-links" data-v-72d47b87><div class="VPSocialLinks social-links-list" data-v-72d47b87 data-v-2513fa97><!--[--><a class="VPSocialLink no-icon" href="https://github.com/gudzpoz/luajava" aria-label="github" target="_blank" rel="noopener" data-v-2513fa97 data-v-c64b0487><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2357968b data-v-00806504><span class="container" data-v-00806504><span class="top" data-v-00806504></span><span class="middle" data-v-00806504></span><span class="bottom" data-v-00806504></span></span></button></div></div></div></div><div class="divider" data-v-2357968b><div class="divider-line" data-v-2357968b></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-bdda0f1c data-v-1e40f313><div class="container" data-v-1e40f313><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-1e40f313><span class="vpi-align-left menu-icon" data-v-1e40f313></span><span class="menu-text" data-v-1e40f313>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-1e40f313 data-v-7ef64a2f><button data-v-7ef64a2f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-bdda0f1c data-v-530469b7><div class="curtain" data-v-530469b7></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-530469b7><span class="visually-hidden" id="sidebar-aria-label" data-v-530469b7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-2ac75d72><section class="VPSidebarItem level-0" data-v-2ac75d72 data-v-24c66f36><div class="item" role="button" tabindex="0" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><h2 class="text" data-v-24c66f36>Introduction</h2><!----></div><div class="items" data-v-24c66f36><!--[--><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/index.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>What is LuaJava?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/getting-started.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/console.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Interactive Console</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/jsr223.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>JSR 223</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/jpms.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Java 9 Platform Module System</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-2ac75d72><section class="VPSidebarItem level-0" data-v-2ac75d72 data-v-24c66f36><div class="item" role="button" tabindex="0" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><h2 class="text" data-v-24c66f36>Java API</h2><!----></div><div class="items" data-v-24c66f36><!--[--><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/java.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Java API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/c-api.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Lua Stack-based C API</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-2ac75d72><section class="VPSidebarItem level-0 has-active" data-v-2ac75d72 data-v-24c66f36><div class="item" role="button" tabindex="0" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><h2 class="text" data-v-24c66f36>Lua API</h2><!----></div><div class="items" data-v-24c66f36><!--[--><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/api.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Lua API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/conversions.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Type Conversions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/proxy.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Proxy Caveats</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/threadsafety.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Thread Safety</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-2ac75d72><section class="VPSidebarItem level-0" data-v-2ac75d72 data-v-24c66f36><div class="item" role="button" tabindex="0" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><h2 class="text" data-v-24c66f36>Examples</h2><!----></div><div class="items" data-v-24c66f36><!--[--><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/examples/compat.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>LuaJava API Compatibility</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/examples/hello-world.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Hello World</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/examples/hello-world-mod.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Advanced Hello World</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/examples/awt.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>AWT Example</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/examples/modules.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Java-Side Modules</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/examples/debug.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Debugging API</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-2ac75d72><section class="VPSidebarItem level-0" data-v-2ac75d72 data-v-24c66f36><div class="item" role="button" tabindex="0" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><h2 class="text" data-v-24c66f36>Troubleshooting</h2><!----></div><div class="items" data-v-24c66f36><!--[--><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/troubleshooting.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Troubleshooting</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/perf.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Performance</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/rtld.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>Using Binary Lua Libraries</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-24c66f36 data-v-24c66f36><div class="item" data-v-24c66f36><div class="indicator" data-v-24c66f36></div><a class="VPLink link link" href="/glibc.html" data-v-24c66f36><!--[--><p class="text" data-v-24c66f36>GNU C Library (glibc) Compatibility</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-bdda0f1c data-v-b3b4c259><div class="VPDoc has-sidebar has-aside" data-v-b3b4c259 data-v-578564d6><!--[--><!--]--><div class="container" data-v-578564d6><div class="aside" data-v-578564d6><div class="aside-curtain" data-v-578564d6></div><div class="aside-container" data-v-578564d6><div class="aside-content" data-v-578564d6><div class="VPDocAside" data-v-578564d6 data-v-a49e46b9><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-a49e46b9 data-v-d41da650><div class="content" data-v-d41da650><div class="outline-marker" data-v-d41da650></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-d41da650>On this page</div><ul class="VPDocOutlineItem root" data-v-d41da650 data-v-64634881><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-a49e46b9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-578564d6><div class="content-container" data-v-578564d6><!--[--><!--]--><main class="main" data-v-578564d6><div style="position:relative;" class="vp-doc _threadsafety external-link-icon-enabled" data-v-578564d6><div data-pagefind-body="true" data-pagefind-meta="date:1767442724000"><h1 id="thread-safety" tabindex="-1">Thread Safety <a class="header-anchor" href="#thread-safety" aria-label="Permalink to &quot;Thread Safety&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">TL;DR</p><p>For now:</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Lua L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getSharedLua</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (L.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMainState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    L.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;print(&#39;operating...&#39;)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><p>No, we are not talking about Lua threads but OS threads.</p><p>The short answer is, <strong>no</strong>, we do not guarantee thread safety. But you may safely access the Lua state across threads with a bit of external synchronization.</p><h2 id="different-main-states" tabindex="-1">Different main states <a class="header-anchor" href="#different-main-states" aria-label="Permalink to &quot;Different main states&quot;">​</a></h2><p>You do not need to worry if you use multiple Lua main states, each dedicated to one OS thread.</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Lua L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LuaJit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Lua J </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LuaJit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// No synchronization needed at all</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(L)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(J)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="same-main-state" tabindex="-1">Same main state <a class="header-anchor" href="#same-main-state" aria-label="Permalink to &quot;Same main state&quot;">​</a></h2><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Lua mainState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LuaJit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Lua subThread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mainState.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Now the two workers need some synchronization mechanism</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mainState)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subThread)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>From Java&#39;s perspective, there are two kinds of operations that might change the Lua state:</p><ol><li>Directly manipulating the Lua state by calling any of the member methods of <code>party.iroiro.luajava.Lua</code>. (You never know what might trigger a Lua GC, so just assume all methods may change the state.)</li><li>Calling methods from the proxied objects, which will ultimately run the underlying Lua functions.</li></ol><p>The key is that we synchronize on all these state-changing operations. Currently, the library synchronizes proxied calls with the main state:</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LuaProxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InvocationHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">invoke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ignored</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Method </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">objects</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (L.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMainState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Calling the underlying Lua function</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>If you doubt that the Lua state is to be accessed across threads, then you are responsible to synchronize on the main state whenever you operate on any of the Lua threads.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>It is not a good API of course. But probably I will not change it in the nearly future.</p></div></div></div></main><footer class="VPDocFooter" data-v-578564d6 data-v-aa64f078><!--[--><!--]--><div class="edit-info" data-v-aa64f078><div class="edit-link" data-v-aa64f078><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/gudzpoz/luajava/blob/main/docs/threadsafety.md" target="_blank" rel="noreferrer" data-v-aa64f078><!--[--><span class="vpi-square-pen edit-link-icon" data-v-aa64f078></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-aa64f078><p class="VPLastUpdated" data-v-aa64f078 data-v-2243d65a>Last updated: <time datetime="2026-01-03T12:18:44.000Z" data-v-2243d65a></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-aa64f078><span class="visually-hidden" id="doc-footer-aria-label" data-v-aa64f078>Pager</span><div class="pager" data-v-aa64f078><a class="VPLink link pager-link prev" href="/proxy.html" data-v-aa64f078><!--[--><span class="desc" data-v-aa64f078>Previous page</span><span class="title" data-v-aa64f078>Proxy Caveats</span><!--]--></a></div><div class="pager" data-v-aa64f078><a class="VPLink link pager-link next" href="/examples/compat.html" data-v-aa64f078><!--[--><span class="desc" data-v-aa64f078>Next page</span><span class="title" data-v-aa64f078>LuaJava API Compatibility</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"DTeOwDue\",\"c-api.md\":\"Cl6BkC3y\",\"console.md\":\"DpdApVMb\",\"conversions.md\":\"DaOYMPhS\",\"examples_awt.md\":\"CzASgMQm\",\"examples_compat.md\":\"CR5UcODK\",\"examples_debug.md\":\"Byz3Y9OY\",\"examples_hello-world-mod.md\":\"CjE9Ef8J\",\"examples_hello-world.md\":\"D67Tipl2\",\"examples_modules.md\":\"54jdYjdD\",\"getting-started.md\":\"CQX_5NDt\",\"glibc.md\":\"0zetaAIo\",\"index.md\":\"64HUZT2t\",\"java.md\":\"CqV3kEy_\",\"jpms.md\":\"B0xKotPz\",\"jsr223.md\":\"DjCQebIC\",\"perf.md\":\"CM3qdEfd\",\"proxy.md\":\"4iVA-SfR\",\"public_javadoc_legal_jquery.md\":\"WphVe13l\",\"public_javadoc_legal_jqueryui.md\":\"BwHO4f9B\",\"rtld.md\":\"DTda-DEp\",\"threadsafety.md\":\"-geGDuQm\",\"troubleshooting.md\":\"BU1oi3gM\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"LuaJava\",\"description\":\"Lua for Java\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/lua-java.svg\",\"lastUpdated\":{},\"editLink\":{\"pattern\":\"https://github.com/gudzpoz/luajava/blob/main/docs/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/gudzpoz/luajava\"}],\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Javadoc\",\"link\":\"/javadoc/index.html\",\"target\":\"_self\"},{\"text\":\"Lua\",\"link\":\"https://www.lua.org\"},{\"text\":\"LuaJIT\",\"link\":\"https://luajit.org/luajit.html\"}],\"outline\":3,\"sidebar\":[{\"text\":\"Introduction\",\"items\":[{\"text\":\"What is LuaJava?\",\"link\":\"/index.md\"},{\"text\":\"Getting Started\",\"link\":\"/getting-started.md\"},{\"text\":\"Interactive Console\",\"link\":\"/console.md\"},{\"text\":\"JSR 223\",\"link\":\"/jsr223.md\"},{\"text\":\"Java 9 Platform Module System\",\"link\":\"/jpms.md\"}]},{\"text\":\"Java API\",\"items\":[{\"text\":\"Java API\",\"link\":\"/java.md\"},{\"text\":\"Lua Stack-based C API\",\"link\":\"/c-api.md\"}]},{\"text\":\"Lua API\",\"items\":[{\"text\":\"Lua API\",\"link\":\"/api.md\"},{\"text\":\"Type Conversions\",\"link\":\"/conversions.md\"},{\"text\":\"Proxy Caveats\",\"link\":\"/proxy.md\"},{\"text\":\"Thread Safety\",\"link\":\"/threadsafety.md\"}]},{\"text\":\"Examples\",\"items\":[{\"text\":\"LuaJava API Compatibility\",\"link\":\"/examples/compat.md\"},{\"text\":\"Hello World\",\"link\":\"/examples/hello-world.md\"},{\"text\":\"Advanced Hello World\",\"link\":\"/examples/hello-world-mod.md\"},{\"text\":\"AWT Example\",\"link\":\"/examples/awt.md\"},{\"text\":\"Java-Side Modules\",\"link\":\"/examples/modules.md\"},{\"text\":\"Debugging API\",\"link\":\"/examples/debug.md\"}]},{\"text\":\"Troubleshooting\",\"items\":[{\"text\":\"Troubleshooting\",\"link\":\"/troubleshooting.md\"},{\"text\":\"Performance\",\"link\":\"/perf.md\"},{\"text\":\"Using Binary Lua Libraries\",\"link\":\"/rtld.md\"},{\"text\":\"GNU C Library (glibc) Compatibility\",\"link\":\"/glibc.md\"}]}],\"externalLinkIcon\":true},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>